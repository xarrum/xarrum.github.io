<!DOCTYPE html>
<html>
	<head>
		<meta charset="utf-8">
		<title>WebGL Test</title>
		<link href="styles/style.css" rel="stylesheet" type="text/css">
		<link href='https://fonts.googleapis.com/css?family=Open+Sans+Condensed:300' rel='stylesheet' type='text/css'>
	</head>
	<body onload="Start()" onresize="Resize()">
		<canvas id="glcanvas">
			Your browser doesn't appear to support the 
			<code>&lt;canvas&gt;</code> element.
		</canvas>
		<div class="canvas-float">
			<p>Behold! The field in which I grow my fucks.<br>Lay thine eyes upon it and see that it is barren.</p>
		</div>
		<script src="scripts/sylvester.js"></script>
		<script src="scripts/gl_util.js"></script>
		<script src="scripts/webgl_test.js"></script>
		<jsconstant id="cube-size">0.75</jsconstant>
		<script id="shader-vs" type="x-shader/x-vertex">
			precision mediump float;
			attribute vec3 aVertexPos;

			uniform mat4 uMVMatrix;
			uniform mat4 uPMatrix;
			uniform vec3 uOffset;
			
			uniform float uCubeSize;
			
			varying vec4 vPosNorm;
			varying vec4 vPos;

			void main(void)
			{
				vPosNorm = vec4(uCubeSize * aVertexPos, 1.0);
				vPos = vec4(uCubeSize * aVertexPos + uOffset, 1.0);
				if(vPosNorm.y <= 0.0)
				{
					vPos.y = -100.0;
					vPosNorm.y = -100.0;
				}
				gl_Position = uPMatrix * uMVMatrix * vPos;
			}
		</script>
		<script id="shader-fs" type="x-shader/x-fragment">
			precision mediump float;
			uniform vec4 uColor;
			uniform float uCubeSize;
			
			varying vec4 vPosNorm;
			varying vec4 vPos;
			void main(void)
			{			
				vec3 absPosNorm = abs(vPosNorm.xyz);
				absPosNorm.y = clamp(vPosNorm.y, 0.0, 1.0);
				float line = max(max(min(absPosNorm.x, absPosNorm.y), min(absPosNorm.z, absPosNorm.y)), min(absPosNorm.x, absPosNorm.z));
				line /= uCubeSize;
				
				float lineWidth = 0.05;
				line = smoothstep(lineWidth, 0.0, 1.0 - line);
				
				float light = 1.0 - (length(vPos.xz)) / 10.0;
				light = pow(light, 1.2);
								
				gl_FragColor = vec4(uColor.xyz * line * light, uColor.w);
			}
		</script>
	</body>
</html>
